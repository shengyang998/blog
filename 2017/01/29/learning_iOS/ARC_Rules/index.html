<!DOCTYPE html><html><head><meta charset="utf-8"><title>ARC Rules | Tech. Design. Life.</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="A note for book Pro Multithreading and Memory Management for iOS and OS XARC is summarized in Apple’s own words:ARC in Objective-C makes memory management the job of the compiler. By enabling ARC with"><meta name="keywords" content="Programming,iOS,Objective C,ARC,Rules,Coming soon..."><meta property="og:type" content="article"><meta property="og:title" content="ARC Rules"><meta property="og:url" content="http://blog.superyoung.win/2017/01/29/learning_iOS/ARC_Rules/index.html"><meta property="og:site_name" content="Tech. Design. Life."><meta property="og:description" content="A note for book Pro Multithreading and Memory Management for iOS and OS XARC is summarized in Apple’s own words:ARC in Objective-C makes memory management the job of the compiler. By enabling ARC with"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2017-01-29T03:30:19.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ARC Rules"><meta name="twitter:description" content="A note for book Pro Multithreading and Memory Management for iOS and OS XARC is summarized in Apple’s own words:ARC in Objective-C makes memory management the job of the compiler. By enabling ARC with"><link rel="alternate" href="/atom.xml" title="Tech. Design. Life." type="application/atom+xml"><link rel="icon" href="/favicon.png"><link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/style.css"></head></html><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap"><a href="/" id="logo">Tech. Design. Life.</a></h1></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/">首页</a> <a class="main-nav-link" href="/archives">归档</a></nav><nav id="sub-nav"><a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a> <a id="nav-search-btn" class="nav-icon" title="搜索"></a></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.superyoung.win"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-learning_iOS/ARC_Rules" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2017/01/29/learning_iOS/ARC_Rules/" class="article-date"><time datetime="2017-01-29T02:19:41.000Z" itemprop="datePublished">2017-01-29</time></a></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">ARC Rules</h1></header><div class="article-entry" itemprop="articleBody"><ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Overview"><span class="post-toc-number">1.</span> <span class="post-toc-text">Overview</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#The-rules-of-Reference-Counting"><span class="post-toc-number">2.</span> <span class="post-toc-text">The rules of Reference Counting</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Newly-introduced-for-ARC-Ownership-Qualifier"><span class="post-toc-number">3.</span> <span class="post-toc-text">Newly introduced for ARC: Ownership Qualifier</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#strong-ownership-qualifier"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">__strong ownership qualifier</span></a></li></ol></li></ol><p>A note for book <a href="http://www.apress.com/us/book/9781430241164" target="_blank" rel="noopener">Pro Multithreading and Memory Management for iOS and OS X</a><br>ARC is summarized in Apple’s own words:</p><blockquote><p>ARC in Objective-C makes memory management the job of the compiler. By enabling ARC with the new Apple LLVM compiler, you will never need to type retain or release again, dramatically simplifying the development process, while reducing craches and memory leaks. The compiler has a complete understanding of your objects, and releases each object the instant it is no longer used, so apps run as fast as ever, with predictable, smooth performance.</p></blockquote><a id="more"></a><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>Actually, reference counting is still used as the basis of ARC. But ARC helps the reference counting mechanism work automatically when you follow its rules.</p><h2 id="The-rules-of-Reference-Counting"><a href="#The-rules-of-Reference-Counting" class="headerlink" title="The rules of Reference Counting"></a>The rules of Reference Counting</h2><ul><li>You have ownership of any objects you create.</li><li>You can take ownership of an object using retain.</li><li>When you no longer need it, you must relinquish ownership of an object of which you have ownership.</li><li>You must not relinquish ownership of an object of which you don’t have ownership.</li></ul><h2 id="Newly-introduced-for-ARC-Ownership-Qualifier"><a href="#Newly-introduced-for-ARC-Ownership-Qualifier" class="headerlink" title="Newly introduced for ARC: Ownership Qualifier"></a>Newly introduced for ARC: Ownership Qualifier</h2><p>In Objective-C, ‘id’ or each object type is used for object variable types.</p><p>Object types are pointer types of Objective-C classes, such as NSObject <em>.’id’ type is used to hide its class name. ‘id’ is equivalent to void</em> in the C language.</p><p>With ARC, ‘id’ and object type variables must have one of the following four ownership qualifiers:<br></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span> __<span class="keyword">strong</span></div><div class="line"><span class="number">2.</span> __<span class="keyword">weak</span></div><div class="line"><span class="number">3.</span> __<span class="keyword">unsafe_unretained</span></div><div class="line"><span class="number">4.</span> __autoreleasing</div></pre></td></tr></table></figure><p></p><p>You should decide which ownership qualifier is to be used for all the ‘id’ and object type variables in your source code. In this chapter, I explain hwo you should choos each qualifier one by one.</p><h3 id="strong-ownership-qualifier"><a href="#strong-ownership-qualifier" class="headerlink" title="__strong ownership qualifier"></a>__strong ownership qualifier</h3><p>The <strong>strong ownership qualifier is used as the default for ‘id’ and object types. It means that the variable obj in the following source code is </strong>strong qualified implicitly.<br></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>Without being explicitly qualified, ‘id’ or objects are treated as __strong. The above code is the same as:<br></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> __<span class="keyword">strong</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>The following is the same source code for a non-ARC environment.<br></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* non-ARC */</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line">    [obj release];</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p>This means the “release” method is automatically added on an ARC environment to release the created object with ownership.</p><p>We add comments on the ownership status:<br></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="keyword">id</span> __<span class="keyword">strong</span> obj = [[<span class="built_in">NSObject</span> alloc] init];</div><div class="line">    <span class="comment">/**</span></div><div class="line">    * The variable obj is qualified with __strong.</div><div class="line">    * Which means, it has the ownership of the object.</div><div class="line">    **/</div><div class="line">&#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">    * Leaving the scope of variable obj, its strong reference disappears.</div><div class="line">    * The object is release automatically,</div><div class="line">    * because no one has ownership, the objec is dispoed of.</div><div class="line">    */</div></pre></td></tr></table></figure><p></p></div><footer class="article-footer"><a data-url="http://blog.superyoung.win/2017/01/29/learning_iOS/ARC_Rules/" data-id="cjdqtvvjl000u27fyugodcgxi" class="article-share-link">Share</a> <a href="http://blog.superyoung.win/2017/01/29/learning_iOS/ARC_Rules/#disqus_thread" class="article-comment-link">留言</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ARC/">ARC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Coming-soon/">Coming soon...</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Objective-C/">Objective C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Programming/">Programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rules/">Rules</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul></footer></div><nav id="article-nav"><a href="/2017/01/29/learning_swift/autoclosure/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">Autoclosure and Lazy Evaluation</div></a><a href="/2017/01/28/how_to_build_a_blog/blog_with_github_pages/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">使用 GitHub Pages 搭建博客指南</div></a></nav></article><section id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">标签云</h3><div class="widget tagcloud"><a href="/tags/ARC/" style="font-size:10px">ARC</a> <a href="/tags/Bit-plane/" style="font-size:10px">Bit-plane</a> <a href="/tags/Block/" style="font-size:10px">Block</a> <a href="/tags/Class/" style="font-size:10px">Class</a> <a href="/tags/Coming-soon/" style="font-size:13.33px">Coming soon...</a> <a href="/tags/Command/" style="font-size:10px">Command</a> <a href="/tags/Computation/" style="font-size:10px">Computation</a> <a href="/tags/Coordinate/" style="font-size:10px">Coordinate</a> <a href="/tags/DATE/" style="font-size:10px">DATE</a> <a href="/tags/DATETIME/" style="font-size:10px">DATETIME</a> <a href="/tags/DataFrame/" style="font-size:10px">DataFrame</a> <a href="/tags/DataSource/" style="font-size:10px">DataSource</a> <a href="/tags/Debug/" style="font-size:10px">Debug</a> <a href="/tags/Delegate/" style="font-size:10px">Delegate</a> <a href="/tags/Difference/" style="font-size:11.67px">Difference</a> <a href="/tags/Digital/" style="font-size:10px">Digital</a> <a href="/tags/Driver/" style="font-size:10px">Driver</a> <a href="/tags/Emacs/" style="font-size:10px">Emacs</a> <a href="/tags/Enum/" style="font-size:10px">Enum</a> <a href="/tags/Experience/" style="font-size:10px">Experience</a> <a href="/tags/G/" style="font-size:10px">G++</a> <a href="/tags/GCC/" style="font-size:10px">GCC</a> <a href="/tags/GDB/" style="font-size:10px">GDB</a> <a href="/tags/GNU/" style="font-size:10px">GNU</a> <a href="/tags/Git/" style="font-size:10px">Git</a> <a href="/tags/GitHub/" style="font-size:10px">GitHub</a> <a href="/tags/Grubbs/" style="font-size:10px">Grubbs</a> <a href="/tags/Guide/" style="font-size:11.67px">Guide</a> <a href="/tags/High-Sierra/" style="font-size:10px">High Sierra</a> <a href="/tags/Image/" style="font-size:10px">Image</a> <a href="/tags/Installation/" style="font-size:10px">Installation</a> <a href="/tags/LLDB/" style="font-size:10px">LLDB</a> <a href="/tags/Language/" style="font-size:11.67px">Language</a> <a href="/tags/Linux/" style="font-size:11.67px">Linux</a> <a href="/tags/Matlab/" style="font-size:11.67px">Matlab</a> <a href="/tags/MySQL/" style="font-size:10px">MySQL</a> <a href="/tags/OS-X/" style="font-size:11.67px">OS X</a> <a href="/tags/ObjC/" style="font-size:10px">ObjC</a> <a href="/tags/Objective-C/" style="font-size:15px">Objective C</a> <a href="/tags/PAT/" style="font-size:10px">PAT</a> <a href="/tags/Pages/" style="font-size:10px">Pages</a> <a href="/tags/Pandas/" style="font-size:10px">Pandas</a> <a href="/tags/Parallel/" style="font-size:10px">Parallel</a> <a href="/tags/Path/" style="font-size:10px">Path</a> <a href="/tags/Photoshop/" style="font-size:10px">Photoshop</a> <a href="/tags/Processing/" style="font-size:10px">Processing</a> <a href="/tags/Programming/" style="font-size:20px">Programming</a> <a href="/tags/Python/" style="font-size:13.33px">Python</a> <a href="/tags/Redirect/" style="font-size:10px">Redirect</a> <a href="/tags/Rules/" style="font-size:10px">Rules</a> <a href="/tags/RxSwift/" style="font-size:11.67px">RxSwift</a> <a href="/tags/SVN/" style="font-size:10px">SVN</a> <a href="/tags/Science/" style="font-size:10px">Science</a> <a href="/tags/Sequence/" style="font-size:10px">Sequence</a> <a href="/tags/Series/" style="font-size:10px">Series</a> <a href="/tags/Server/" style="font-size:13.33px">Server</a> <a href="/tags/Shell/" style="font-size:11.67px">Shell</a> <a href="/tags/Sierra/" style="font-size:10px">Sierra</a> <a href="/tags/Spotlight/" style="font-size:10px">Spotlight</a> <a href="/tags/Struct/" style="font-size:10px">Struct</a> <a href="/tags/Swift/" style="font-size:16.67px">Swift</a> <a href="/tags/System/" style="font-size:10px">System</a> <a href="/tags/TIMESTAMP/" style="font-size:10px">TIMESTAMP</a> <a href="/tags/TenserFlow/" style="font-size:10px">TenserFlow</a> <a href="/tags/Tutorial/" style="font-size:11.67px">Tutorial</a> <a href="/tags/UIAlertController/" style="font-size:10px">UIAlertController</a> <a href="/tags/UITableView/" style="font-size:10px">UITableView</a> <a href="/tags/Unit/" style="font-size:10px">Unit</a> <a href="/tags/Wavelet/" style="font-size:10px">Wavelet</a> <a href="/tags/Working/" style="font-size:10px">Working</a> <a href="/tags/autoclosure/" style="font-size:10px">autoclosure</a> <a href="/tags/blog/" style="font-size:10px">blog</a> <a href="/tags/filter/" style="font-size:10px">filter</a> <a href="/tags/hexo/" style="font-size:10px">hexo</a> <a href="/tags/iOS/" style="font-size:18.33px">iOS</a> <a href="/tags/instance/" style="font-size:10px">instance</a> <a href="/tags/keyboard/" style="font-size:10px">keyboard</a> <a href="/tags/language/" style="font-size:10px">language</a> <a href="/tags/lazy-evaluation/" style="font-size:10px">lazy evaluation</a> <a href="/tags/log/" style="font-size:10px">log</a> <a href="/tags/macOS/" style="font-size:11.67px">macOS</a> <a href="/tags/map/" style="font-size:10px">map</a> <a href="/tags/parfor/" style="font-size:10px">parfor</a> <a href="/tags/reduce/" style="font-size:10px">reduce</a> <a href="/tags/type/" style="font-size:11.67px">type</a> <a href="/tags/which/" style="font-size:10px">which</a> <a href="/tags/优化算法/" style="font-size:10px">优化算法</a> <a href="/tags/优化问题/" style="font-size:10px">优化问题</a> <a href="/tags/修图/" style="font-size:10px">修图</a> <a href="/tags/入门/" style="font-size:10px">入门</a> <a href="/tags/响应式/" style="font-size:11.67px">响应式</a> <a href="/tags/噪声/" style="font-size:10px">噪声</a> <a href="/tags/坐标系统/" style="font-size:10px">坐标系统</a> <a href="/tags/小波/" style="font-size:10px">小波</a> <a href="/tags/开发/" style="font-size:11.67px">开发</a> <a href="/tags/异常值/" style="font-size:10px">异常值</a> <a href="/tags/教程/" style="font-size:11.67px">教程</a> <a href="/tags/服务器/" style="font-size:11.67px">服务器</a> <a href="/tags/机器学习/" style="font-size:10px">机器学习</a> <a href="/tags/模拟退火算法/" style="font-size:10px">模拟退火算法</a> <a href="/tags/神经网络/" style="font-size:10px">神经网络</a> <a href="/tags/缺失值/" style="font-size:10px">缺失值</a> <a href="/tags/遗传算法/" style="font-size:10px">遗传算法</a> <a href="/tags/配置/" style="font-size:11.67px">配置</a> <a href="/tags/降噪/" style="font-size:10px">降噪</a></div></div><div class="widget-wrap"><h3 class="widget-title">最新文章</h3><div class="widget"><ul><li><a href="/2018/04/03/notes/why_number_should_start_at_zero/">为什么 Python 的 Range 要设计成左开右闭区间？为什么数组下标要从零开始？</a></li><li><a href="/2018/03/20/pat/advanced_level/1141/">PAT 1141 Python C++ 解题</a></li><li><a href="/2018/01/25/notes/install_tensorflow_from_source_for_macos/">Instruction of Installing TensorFlow From Source</a></li><li><a href="/2017/10/28/learning_emacs/start_server/">Setting Up Emacs Server to Speed Up Your Emacs</a></li><li><a href="/2017/10/07/learning_python/compile_executable_with_cython/">用 Cython 把 Python 文件编译成可执行文件</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">归档</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2018 Yu Shengyang<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></div></div></footer><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c2f3493bffeb398373d9cda4fd1c6636";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-91049921-1","auto"),ga("send","pageview")</script></div><nav id="mobile-nav"><a href="/" class="mobile-nav-link">首页</a> <a href="/archives" class="mobile-nav-link">归档</a></nav><script>var disqus_shortname="blog-ysy",disqus_url="http://blog.superyoung.win/2017/01/29/learning_iOS/ARC_Rules/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/js/script.js"></script></div></body>