var kStageIsReadyEvent="StageManager:StageIsReadyEvent";var StageManager=Class.create({initialize:function(e,t){this.textureManager=e;this.scriptManager=t;this.stage=document.getElementById("stage");this.hyperlinkPlane=document.getElementById("hyperlinkPlane");this.stageWidth=0;this.stageHeight=0;this.showWidth=0;this.showHeight=0;this.audioTrackOffset=0;this.audioTrackIconSize=0;document.observe(kShowSizeDidChangeEvent,this.handleShowSizeDidChangeEvent.bind(this));document.observe(kStageSizeDidChangeEvent,this.handleStageSizeDidChangeEvent.bind(this))},removeTexture:function(e){e.parentNode.removeChild(e)},addHyperlink:function(e){var t=document.createElement("div");setElementProperty(t,"pointer-events","all");t.setAttribute("class","hyperlink");t.style.left=e.x+"px";t.style.top=e.y+"px";t.style.width=e.width+"px";t.style.height=e.height+"px";this.hyperlinkPlane.appendChild(t)},clearAllHyperlinks:function(){var e;while(this.hyperlinkPlane.childNodes.length>0){this.hyperlinkPlane.removeChild(this.hyperlinkPlane.firstChild)}this.audioTrackOffset=this.audioTrackSpacer},handleStageSizeDidChangeEvent:function(e){this.stageWidth=e.memo.width;this.stageHeight=e.memo.height;this.adjustStageToFit(this.stage);this.adjustStageToFit(this.hyperlinkPlane)},handleShowSizeDidChangeEvent:function(e){this.showWidth=e.memo.width;this.showHeight=e.memo.height;this.adjustStageToFit(this.stage);this.adjustStageToFit(this.hyperlinkPlane);this.audioTrackIconSize=this.showHeight/4;this.audioTrackSpacer=this.audioTrackIconSize/4;this.audioTrackOffset=this.audioTrackSpacer},adjustStageToFit:function(e){if(this.showWidth!=0&&this.stageWidth!=0){var t=this.stageHeight/this.showHeight;var i=this.stageWidth/this.showWidth;var h="scaleX("+i+") scaleY("+t+")";var s=20;var a=Math.tan(Math.PI/180*s/2)*15*(this.showWidth>this.showHeight?this.showHeight:this.showWidth);this.perspective=a;setElementProperty(e,kTransformOriginPropertyName,kTransformOriginCenterPropertyValue);setElementProperty(e,kTransformPropertyName,h);setElementProperty(e,kPerspectiveOriginPropertyName,kTransformOriginCenterPropertyValue);setElementProperty(e,kTransformStylePropertyName,kTransformStylePreserve3DPropertyValue);setElementPosition(e,(t-1)*this.showHeight/2,(i-1)*this.showWidth/2,this.showWidth,this.showHeight);document.fire(kStageIsReadyEvent,{})}},debugGetStageStatistics:function(){var e={numTextures:0,numPixels:0,numDegraded:0};this.debugRecursivelyWalkDomFrom(this.stage,e);return e}});